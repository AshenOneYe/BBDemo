{"version":3,"sources":["game.js"],"names":["cc","Class","extends","Component","properties","noteBar","default","type","Prefab","startBtn","Node","combo","visible","gamePause","window","Global","gameState","getComponent","AudioSource","pause","gameResume","resume","gamePauseOrResume","onLoad","timePassed","timer","perfectCount","greatCount","goodCount","badCount","missCount","maxCombo","self","loader","loadRes","err","object","alert","initBars","json","beatMap","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","gameStart","pauseButton","node","getChildByName","pausePanel","opacity","setPosition","v2","runAction","fadeIn","continueBtn","back2manuBtn","fadeOut","setTimeout","console","log","x","director","loadScene","finishPanel","musicDuration","getDuration","play","numOfBars","length","bar","newNoteBar","instantiate","addChild","name","event","keyCode","macro","KEY","escape","start","update","dt","Label","string","getCurrentTime","lastNoteJudgement"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\t\tnoteBar:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Prefab\r\n\t\t},\r\n\t\t\r\n\t\tstartBtn:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node\r\n\t\t},\r\n\t\t\r\n\t\tcombo:{//目前combo数\r\n\t\t\tdefault:0,\r\n\t\t\tvisible:false\r\n\t\t}\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n\tgamePause:function(){\r\n\t\t//cc.game.pause();//游戏主循环暂停\r\n\t\twindow.Global.gameState = 'pause';\r\n\t\tthis.getComponent(cc.AudioSource).pause();//音乐暂停\r\n\t},\r\n\t\r\n\tgameResume:function(){\r\n\t\t//cc.game.resume();\r\n\t\twindow.Global.gameState = 'playing';\r\n\t\tthis.getComponent(cc.AudioSource).resume();//音乐恢复\r\n\t\r\n\t},\r\n\t\r\n\tgamePauseOrResume:function(){\r\n\t\tif(window.Global.gameState === 'pause')\t{\r\n\t\t\tthis.gameResume();\r\n\t\t}\r\n\t\telse if(window.Global.gameState === 'playing'){\r\n\t\t\tthis.gamePause();\r\n\t\t}\r\n\t},\r\n\r\n    onLoad () {\r\n\t\t//初始化\r\n\t\twindow.Global.timePassed = 0;//初始化游戏时间\r\n\t\twindow.Global.timer = 0;\r\n\t\twindow.Global.combo = 0;\r\n\t\twindow.Global.perfectCount=0;\r\n\t\twindow.Global.greatCount=0;\r\n\t\twindow.Global.goodCount=0;\r\n\t\twindow.Global.badCount=0;\r\n\t\twindow.Global.missCount=0;\r\n\t\twindow.Global.maxCombo=0;\r\n\t\twindow.Global.gameState = 'manu';\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tcc.loader.loadRes('beatMap.json', function (err, object) {\r\n\t\t\tif (err) {\r\n\t\t\t\talert(err);\r\n\t\t\t\treturn;\r\n\t\t\t}\t\t\r\n\t\t\t// 读取的数据返回在object中\r\n\t\t\t//初始化各个轨道\r\n\t\t\tself.initBars(object.json.beatMap);\r\n\t\t});\r\n\t\t\r\n\t\t//esc暂停\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\t\r\n\t\tvar startBtn = this.startBtn;\r\n\t\tstartBtn.on('touchend',self.gameStart,this);\r\n\t\t\r\n\t\t//为暂停按钮添加监听函数\r\n\t\tvar pauseButton = this.node.getChildByName('pauseButton');\r\n\t\t\r\n\t\tvar pausePanel = this.node.getChildByName('pausePanel');//暂停弹窗\r\n\t\t\r\n\t\tpauseButton.on('touchend',function(){\r\n\t\t\tif(window.Global.gameState === 'playing'){\r\n\t\t\t\tself.gamePauseOrResume();\r\n\t\t\t\tpausePanel.opacity = 0;\r\n\t\t\t\tpausePanel.setPosition(cc.v2(0,0));\r\n\t\t\t\tpausePanel.runAction(cc.fadeIn(0.2));\r\n\t\t\t}\r\n\t\t},pauseButton);\r\n\t\t\r\n\t\tvar continueBtn = pausePanel.getChildByName('continueBtn');\r\n\t\tvar back2manuBtn = pausePanel.getChildByName('back2manuBtn');\r\n\t\t\r\n\t\tcontinueBtn.on('touchend',function(){\r\n\t\t\tpausePanel.runAction(cc.fadeOut(0.2));\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tconsole.log(3);\r\n\t\t\t},200);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tconsole.log(2);\r\n\t\t\t},1200);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tconsole.log(1);\r\n\t\t\t},2200);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tpausePanel.x=10000;//隐藏\r\n\t\t\t\tself.gamePauseOrResume();\r\n\t\t\t},3200);\r\n\t\t},continueBtn);\r\n\t\t\r\n\t\tback2manuBtn.on('touchend',function(){\r\n\t\t\tcc.director.loadScene('game');\r\n\t\t},back2manuBtn);\r\n\t\t\r\n\t\t//为结束界面添加监听函数\r\n\t\tvar finishPanel = this.node.getChildByName('finishPanel');\r\n\t\tfinishPanel.on('touchend',function(){\r\n\t\t\tcc.director.loadScene('game');\r\n\t\t},finishPanel);\r\n\t},\r\n\r\n\tgameStart:function(){//开始按钮的功能\r\n\t\tvar self = this;\t\t\r\n\t\twindow.Global.musicDuration = this.node.getComponent(cc.AudioSource).getDuration();\r\n\t\tthis.timePassed = 0;//初始化游戏时间\r\n\t\tthis.node.getChildByName('manu').x=10000;//主菜单隐藏\r\n\t\tthis.node.getChildByName('songInfo').setPosition(cc.v2(0,0));//显示歌曲信息\r\n\t\tthis.node.getChildByName('songInfo').opacity = 0;//先设置透明度为零\r\n\t\tthis.node.getChildByName('songInfo').runAction(cc.fadeIn(1));//然后淡入\r\n\t\tsetTimeout(function(){\r\n\t\t\tself.node.getChildByName('songInfo').runAction(cc.fadeOut(1));//两秒后淡出\r\n\t\t},2000);//延迟2000毫秒执行function\r\n\t\t\r\n\t\tsetTimeout(function(){//信息提示结束后一秒钟开始游戏\r\n\t\t\tself.node.getChildByName('songInfo').x=10000;//歌曲信息隐藏\r\n\t\t\tself.getComponent(cc.AudioSource).play();//播放音乐\r\n\t\t\twindow.Global.gameState = 'playing';//设置游戏状态为playing\r\n\t\t},4000);//延迟4000毫秒执行function\r\n\t},\r\n\t\r\n\tinitBars:function(beatMap){//初始化各个轨道\r\n\t\tvar numOfBars = beatMap.length;\r\n\t\tfor(var bar = 0;bar<numOfBars;bar++){\r\n\t\t\tvar newNoteBar = cc.instantiate(this.noteBar);\t\t\r\n\t\t\tthis.node.getChildByName('noteBarArea').addChild(newNoteBar);\t\r\n\t\t\tnewNoteBar.getComponent('noteBar').beatMap =beatMap[bar];\t\r\n\t\t\tnewNoteBar.name = ''+bar;\r\n\t\t}\r\n\t},\r\n\t\r\n\tonKeyDown:function(event){\r\n\t\tif(event.keyCode == cc.macro.KEY.escape){\r\n\t\t\tthis.gamePauseOrResume();//暂停或恢复\r\n\t\t}\r\n\t},\r\n\r\n    start () {\r\n\t\t\r\n    },\r\n\t\r\n    update (dt) {\r\n\t\tif(window.Global.gameState === 'playing'){\r\n\t\t\tif(window.Global.musicDuration-window.Global.timePassed<0.2){\r\n\t\t\t\twindow.Global.gameState = 'finish';\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar finishPanel = this.node.getChildByName('finishPanel');\r\n\t\t\t\tsetTimeout(function(){\t\t\t\t\r\n\t\t\t\t\tfinishPanel.getChildByName('perfectCount').getComponent(cc.Label).string = 'Perfect：'+window.Global.perfectCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('greatCount').getComponent(cc.Label).string = 'Great：'+window.Global.greatCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('goodCount').getComponent(cc.Label).string = 'Good：'+window.Global.goodCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('badCount').getComponent(cc.Label).string = 'Bad：'+window.Global.badCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('missCount').getComponent(cc.Label).string = 'Miss：'+window.Global.missCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('maxCombo').getComponent(cc.Label).string = 'MaxCombo：'+window.Global.maxCombo;\r\n\t\t\t\t\tfinishPanel.setPosition(cc.v2(0,0));\r\n\t\t\t\t},3000);\r\n\t\t\t}\r\n\t\t\twindow.Global.timePassed = this.getComponent(cc.AudioSource).getCurrentTime();//记录音乐播放的时间\t\r\n\t\t\t//miss信息三秒消失\r\n\t\t\tif(window.Global.lastNoteJudgement === 'miss')\r\n\t\t\t{\r\n\t\t\t\twindow.Global.timer += dt;\r\n\t\t\t}else{\r\n\t\t\t\twindow.Global.timer=0;\r\n\t\t\t}\r\n\t\t\tif(window.Global.timer>3)\r\n\t\t\t{\r\n\t\t\t\tthis.node.getChildByName('comboLabel').getComponent(cc.Label).string = '';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n});\r\n"]}