{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\game.js"],"names":["cc","Class","extends","Component","properties","noteBar","default","type","Prefab","startBtn","Node","settingBtn","combo","visible","gamePause","window","Global","gameState","getComponent","AudioSource","pause","gameResume","resume","gamePauseOrResume","onLoad","timePassed","timer","perfectCount","greatCount","goodCount","badCount","missCount","maxCombo","self","loader","loadRes","err","object","alert","initBars","json","beatMap","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","gameStart","settingPanel","node","getChildByName","speedLabel","Label","string","gameSpeed","offsetLabel","offset","speedSlider","Slider","progress","parseFloat","offsetSlider","accuracyOffset","find","Toggle","isChecked","y","returnBtn","confirmBtn","speed","slider","toFixed","parseInt","perfectTime","perfectTimeModel","greatTime","greatTimeModel","goodTime","goodTimeModel","badTime","badTimeModel","missTime","missTimeModel","director","loadScene","pauseButton","pausePanel","opacity","setPosition","v2","runAction","fadeIn","continueBtn","back2manuBtn","daojishi","fadeOut","setTimeout","x","finishPanel","musicDuration","getDuration","play","numOfBars","length","bar","newNoteBar","instantiate","addChild","name","event","keyCode","macro","KEY","escape","start","update","dt","getCurrentTime","lastNoteJudgement"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\t\tnoteBar:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Prefab\r\n\t\t},\r\n\t\t\r\n\t\tstartBtn:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node\r\n\t\t},\r\n\t\t\r\n\t\tsettingBtn:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node\r\n\t\t},\r\n\t\t\r\n\t\tcombo:{//目前combo数\r\n\t\t\tdefault:0,\r\n\t\t\tvisible:false\r\n\t\t}\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n\tgamePause:function(){\r\n\t\t//cc.game.pause();//游戏主循环暂停\r\n\t\twindow.Global.gameState = 'pause';\r\n\t\tthis.getComponent(cc.AudioSource).pause();//音乐暂停\r\n\t},\r\n\t\r\n\tgameResume:function(){\r\n\t\t//cc.game.resume();\r\n\t\twindow.Global.gameState = 'playing';\r\n\t\tthis.getComponent(cc.AudioSource).resume();//音乐恢复\r\n\t\r\n\t},\r\n\t\r\n\tgamePauseOrResume:function(){\r\n\t\tif(window.Global.gameState === 'pause')\t{\r\n\t\t\tthis.gameResume();\r\n\t\t}\r\n\t\telse if(window.Global.gameState === 'playing'){\r\n\t\t\tthis.gamePause();\r\n\t\t}\r\n\t},\r\n\r\n    onLoad () {\r\n\t\t//初始化\r\n\t\twindow.Global.timePassed = 0;//初始化游戏时间\r\n\t\twindow.Global.timer = 0;\r\n\t\twindow.Global.combo = 0;\r\n\t\twindow.Global.perfectCount=0;\r\n\t\twindow.Global.greatCount=0;\r\n\t\twindow.Global.goodCount=0;\r\n\t\twindow.Global.badCount=0;\r\n\t\twindow.Global.missCount=0;\r\n\t\twindow.Global.maxCombo=0;\r\n\t\twindow.Global.gameState = 'manu';\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tcc.loader.loadRes('beatMap.json', function (err, object) {\r\n\t\t\tif (err) {\r\n\t\t\t\talert(err);\r\n\t\t\t\treturn;\r\n\t\t\t}\t\t\r\n\t\t\t// 读取的数据返回在object中\r\n\t\t\t//初始化各个轨道\r\n\t\t\tself.initBars(object.json.beatMap);\r\n\t\t});\r\n\t\t\r\n\t\t//esc暂停\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\t\r\n\t\tvar startBtn = this.startBtn;\r\n\t\tstartBtn.on('touchend',self.gameStart,this);\r\n\t\t\r\n\t\t\r\n\t\t//为设置按钮添加监听函数\r\n\t\tvar settingBtn = this.settingBtn;\r\n\t\tvar settingPanel = this.node.getChildByName('settingPanel');\r\n\t\tsettingBtn.on('touchend',function(){\r\n\t\t\tspeedLabel.getComponent(cc.Label).string = \"游戏速度：\"+window.Global.gameSpeed+\"(pixel/s)\";\t\t\r\n\t\t\toffsetLabel.getComponent(cc.Label).string = \"游戏偏移：\"+window.Global.offset*1000+\"(ms)\";\r\n\t\t\tspeedSlider.getComponent(cc.Slider).progress = parseFloat(window.Global.gameSpeed-300)/1000;\r\n\t\t\toffsetSlider.getComponent(cc.Slider).progress = window.Global.offset*10+0.5;\r\n\t\t\tswitch(window.Global.accuracyOffset){\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tcc.find('accuracyArea/accuracyToggleContainer/accurate',settingPanel).getComponent(cc.Toggle).isChecked = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 0.01:\r\n\t\t\t\t\tcc.find('accuracyArea/accuracyToggleContainer/normal',settingPanel).getComponent(cc.Toggle).isChecked = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 0.02:\r\n\t\t\t\t\tcc.find('accuracyArea/accuracyToggleContainer/fuzzy',settingPanel).getComponent(cc.Toggle).isChecked = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t\tsettingPanel.y=0;\r\n\t\t},settingBtn);\r\n\t\t\r\n\t\t//完善设置界面\r\n\t\tvar returnBtn = cc.find('buttonArea/returnBtn',settingPanel);\r\n\t\tvar confirmBtn = cc.find('buttonArea/confirmBtn',settingPanel);\r\n\t\tvar speedSlider = cc.find('speedArea/speedSlider',settingPanel);\r\n\t\tvar speedLabel = cc.find('speedArea/speedLabel',settingPanel);\r\n\t\tvar offsetSlider = cc.find('offsetArea/offsetSlider',settingPanel);\r\n\t\tvar offsetLabel = cc.find('offsetArea/offsetLabel',settingPanel);\r\n\t\t\r\n\t\tthis.speed = window.Global.gameSpeed;\r\n\t\tthis.offset = window.Global.offset;\r\n\t\t\r\n\t\tspeedSlider.on('slide',function(slider){\r\n\t\t\tslider.progress=slider.progress.toFixed(1);\r\n\t\t\tvar speed = 800 + (slider.progress-0.5)*1000;\r\n\t\t\tspeedLabel.getComponent(cc.Label).string = \"游戏速度：\"+speed+\"(pixel/s)\";\r\n\t\t\tthis.speed = speed;\r\n\t\t},this);\r\n\t\t\r\n\t\toffsetSlider.on('slide',function(slider){\r\n\t\t\tslider.progress=slider.progress.toFixed(2);\r\n\t\t\tvar offset =parseInt(slider.progress*100)-50;\r\n\t\t\toffsetLabel.getComponent(cc.Label).string = \"游戏偏移：\"+offset+\"(ms)\";\r\n\t\t\tthis.offset = offset;\r\n\t\t},this);\r\n\t\t\r\n\t\treturnBtn.on('touchend',function(){\r\n\t\t\tsettingPanel.y=10000;\r\n\t\t},returnBtn);\r\n\t\tconfirmBtn.on('touchend',function(){\r\n\t\t\tsettingPanel.y=10000;\r\n\t\t\twindow.Global.gameSpeed = self.speed;\r\n\t\t\twindow.Global.offset = parseFloat(self.offset)/1000;\r\n\t\t\tif(cc.find('accuracyArea/accuracyToggleContainer/accurate',settingPanel).getComponent(cc.Toggle).isChecked){\r\n\t\t\t\twindow.Global.accuracyOffset = 0;\r\n\t\t\t}else if(cc.find('accuracyArea/accuracyToggleContainer/fuzzy',settingPanel).getComponent(cc.Toggle).isChecked){\r\n\t\t\t\twindow.Global.accuracyOffset = 0.015;\r\n\t\t\t}else{\r\n\t\t\t\twindow.Global.accuracyOffset = 0.01;\r\n\t\t\t}\r\n\t\t\twindow.Global.perfectTime = (window.Global.perfectTimeModel + window.Global.accuracyOffset).toFixed(2);\r\n\t\t\twindow.Global.greatTime = (window.Global.greatTimeModel + window.Global.accuracyOffset).toFixed(2);\r\n\t\t\twindow.Global.goodTime = (window.Global.goodTimeModel + window.Global.accuracyOffset).toFixed(2);\r\n\t\t\twindow.Global.badTime = (window.Global.badTimeModel + window.Global.accuracyOffset).toFixed(2);\r\n\t\t\twindow.Global.missTime = (window.Global.missTimeModel + window.Global.accuracyOffset).toFixed(2);\r\n\t\t\tcc.director.loadScene('game');\r\n\t\t},confirmBtn);\r\n\t\t\r\n\t\t//为暂停按钮添加监听函数\r\n\t\tvar pauseButton = this.node.getChildByName('pauseButton');\r\n\t\t\r\n\t\tvar pausePanel = this.node.getChildByName('pausePanel');//暂停弹窗\r\n\t\t\r\n\t\tpauseButton.on('touchend',function(){\r\n\t\t\tif(window.Global.gameState === 'playing'){\r\n\t\t\t\tself.gamePauseOrResume();\r\n\t\t\t\tpausePanel.opacity = 0;\r\n\t\t\t\tpausePanel.setPosition(cc.v2(0,0));\r\n\t\t\t\tpausePanel.runAction(cc.fadeIn(0.2));\r\n\t\t\t}\r\n\t\t},pauseButton);\r\n\t\t\r\n\t\tvar continueBtn = pausePanel.getChildByName('continueBtn');\r\n\t\tvar back2manuBtn = pausePanel.getChildByName('back2manuBtn');\r\n\t\tvar daojishi = this.node.getChildByName('daojishi');\r\n\t\t\r\n\t\tcontinueBtn.on('touchend',function(){\r\n\t\t\tpausePanel.runAction(cc.fadeOut(0.2));\r\n\t\t\tsetTimeout(function(){//倒计时\r\n\t\t\t\tdaojishi.y=0;//3\r\n\t\t\t\tdaojishi.getComponent(cc.Label).string = \"倒计时：3\";\r\n\t\t\t},200);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tdaojishi.getComponent(cc.Label).string = \"倒计时：2\";\r\n\t\t\t},1200);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tdaojishi.getComponent(cc.Label).string = \"倒计时：1\";\r\n\t\t\t},2200);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tdaojishi.getComponent(cc.Label).string = \"倒计时：0\";\r\n\t\t\t\tdaojishi.y=10000;\r\n\t\t\t\tpausePanel.x=10000;//隐藏\r\n\t\t\t\tself.gamePauseOrResume();\r\n\t\t\t},3200);\r\n\t\t},continueBtn);\r\n\t\t\r\n\t\tback2manuBtn.on('touchend',function(){\r\n\t\t\tcc.director.loadScene('game');\r\n\t\t},back2manuBtn);\r\n\t\t\r\n\t\t//为结束界面添加监听函数\r\n\t\tvar finishPanel = this.node.getChildByName('finishPanel');\r\n\t\tfinishPanel.on('touchend',function(){\r\n\t\t\tcc.director.loadScene('game');\r\n\t\t},finishPanel);\r\n\t},\r\n\t\r\n\tgameStart:function(){//开始按钮的功能\r\n\t\tvar self = this;\t\t\r\n\t\twindow.Global.musicDuration = this.node.getComponent(cc.AudioSource).getDuration();\r\n\t\tthis.timePassed = 0;//初始化游戏时间\r\n\t\tthis.node.getChildByName('manu').x=10000;//主菜单隐藏\r\n\t\tthis.node.getChildByName('songInfo').setPosition(cc.v2(0,0));//显示歌曲信息\r\n\t\tthis.node.getChildByName('songInfo').opacity = 0;//先设置透明度为零\r\n\t\tthis.node.getChildByName('songInfo').runAction(cc.fadeIn(1));//然后淡入\r\n\t\tsetTimeout(function(){\r\n\t\t\tself.node.getChildByName('songInfo').runAction(cc.fadeOut(1));//两秒后淡出\r\n\t\t},2000);//延迟2000毫秒执行function\r\n\t\t\r\n\t\tsetTimeout(function(){//信息提示结束后一秒钟开始游戏\r\n\t\t\tself.node.getChildByName('songInfo').x=10000;//歌曲信息隐藏\r\n\t\t\tself.getComponent(cc.AudioSource).play();//播放音乐\r\n\t\t\twindow.Global.gameState = 'playing';//设置游戏状态为playing\r\n\t\t},4000);//延迟4000毫秒执行function\r\n\t},\r\n\t\r\n\tinitBars:function(beatMap){//初始化各个轨道\r\n\t\tvar numOfBars = beatMap.length;\r\n\t\tfor(var bar = 0;bar<numOfBars;bar++){\r\n\t\t\tvar newNoteBar = cc.instantiate(this.noteBar);\t\t\r\n\t\t\tthis.node.getChildByName('noteBarArea').addChild(newNoteBar);\t\r\n\t\t\tnewNoteBar.getComponent('noteBar').beatMap =beatMap[bar];\t\r\n\t\t\tnewNoteBar.name = ''+bar;\r\n\t\t}\r\n\t},\r\n\t\r\n\tonKeyDown:function(event){\r\n\t\tif(event.keyCode == cc.macro.KEY.escape){\r\n\t\t\tthis.gamePauseOrResume();//暂停或恢复\r\n\t\t}\r\n\t},\r\n\r\n    start () {\r\n\t\t\r\n    },\r\n\t\r\n    update (dt) {\r\n\t\tif(window.Global.gameState === 'playing'){\r\n\t\t\tif(window.Global.musicDuration-window.Global.timePassed<0.2){\r\n\t\t\t\twindow.Global.gameState = 'finish';\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar finishPanel = this.node.getChildByName('finishPanel');\r\n\t\t\t\tsetTimeout(function(){\t\t\t\t\r\n\t\t\t\t\tfinishPanel.getChildByName('perfectCount').getComponent(cc.Label).string = 'Perfect：'+window.Global.perfectCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('greatCount').getComponent(cc.Label).string = 'Great：'+window.Global.greatCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('goodCount').getComponent(cc.Label).string = 'Good：'+window.Global.goodCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('badCount').getComponent(cc.Label).string = 'Bad：'+window.Global.badCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('missCount').getComponent(cc.Label).string = 'Miss：'+window.Global.missCount;\r\n\t\t\t\t\tfinishPanel.getChildByName('maxCombo').getComponent(cc.Label).string = 'MaxCombo：'+window.Global.maxCombo;\r\n\t\t\t\t\tfinishPanel.setPosition(cc.v2(0,0));\r\n\t\t\t\t},3000);\r\n\t\t\t}\r\n\t\t\twindow.Global.timePassed = this.getComponent(cc.AudioSource).getCurrentTime();//记录音乐播放的时间\t\r\n\t\t\t//miss信息三秒消失\r\n\t\t\tif(window.Global.lastNoteJudgement === 'miss')\r\n\t\t\t{\r\n\t\t\t\twindow.Global.timer += dt;\r\n\t\t\t}else{\r\n\t\t\t\twindow.Global.timer=0;\r\n\t\t\t}\r\n\t\t\tif(window.Global.timer>3)\r\n\t\t\t{\r\n\t\t\t\tthis.node.getChildByName('comboLabel').getComponent(cc.Label).string = '';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n});\r\n"]}